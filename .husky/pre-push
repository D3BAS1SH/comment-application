#!/usr/bin/env sh

# Get the current branch name
current_branch=$(git rev-parse --abbrev-ref HEAD)
protected_branches="main|master|production"
integration_branches="dev|develop|staging"

echo "ğŸ” Current branch: $current_branch"

if echo "$current_branch" | grep -E "^($protected_branches)$" > /dev/null; then
  echo "ğŸ”’ Protected branch detected. Running full checks..."
  
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run lint
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run format:check
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run test:ci || (echo "âŒ Tests must pass before pushing to $current_branch!" && exit 1)
  
  echo "âœ… All checks passed for protected branch!"
  
elif echo "$current_branch" | grep -E "^($integration_branches)$" > /dev/null; then
  echo "ï¿½ Integration branch detected. Running standard checks..."
  
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run lint
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run format:check
  
  echo "âš ï¸ Warning: Tests are being skipped for integration branch. Remember to run tests before merging to main!"
  
else
  echo "ğŸš€ Feature branch detected. Running minimal checks..."
  
  # Only format check for feature branches - very lenient
  cd "$(git rev-parse --show-toplevel)/apps/frontend" && npm run format:check
  
  echo "â„¹ï¸ Info: Only formatting checked for feature branch. Run 'npm run lint' and 'npm test' locally when ready!"
fi